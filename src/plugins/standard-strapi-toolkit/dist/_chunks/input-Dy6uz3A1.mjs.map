{"version":3,"file":"input-Dy6uz3A1.mjs","sources":["../../admin/src/fields/multi-select/input.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\r\nimport { Field, Flex } from '@strapi/design-system';\r\nimport ReactSelect from './react-select';\r\nimport { useField } from '@strapi/strapi/admin';\r\nimport { useIntl } from 'react-intl';\r\nimport ValueContainer from './value-container';\r\n\r\n\r\nconst Input = ({\r\n  hint,\r\n  label,\r\n  name,\r\n  intlLabel,\r\n  required,\r\n  attribute,\r\n  description,\r\n  placeholder,\r\n  disabled,\r\n}: {\r\n  hint: string;\r\n  label: string;\r\n  name: string;\r\n  intlLabel: any;\r\n  required: boolean;\r\n  attribute: any;\r\n  description: any;\r\n  placeholder: string;\r\n  disabled: boolean;\r\n}) => {\r\n  const { formatMessage } = useIntl();\r\n  const { onChange, value, error } = useField(name);\r\n\r\n  const possibleOptions = useMemo(() => {\r\n    return (attribute['options'] || [])\r\n      .map((option: string) => {\r\n        const [label, value] = [...option.split(/:(.*)/s), option];\r\n        if (!label || !value) return null;\r\n        return { label, value };\r\n      })\r\n      .filter(Boolean);\r\n  }, [attribute]);\r\n\r\n  const sanitizedValue = useMemo(() => {\r\n    let parsedValue;\r\n    try {\r\n      parsedValue = typeof value !== 'string' ? value || [] : JSON.parse(value || '[]');\r\n    } catch (e) {\r\n      parsedValue = [];\r\n    }\r\n    return Array.isArray(parsedValue)\r\n      ? parsedValue\r\n        .map((val) =>\r\n          possibleOptions.find((option: { label: string; value: string }) => option.value === val)\r\n        )\r\n        .filter((option) => !!option)\r\n      : [];\r\n  }, [value, possibleOptions]);\r\n\r\n  const fieldError = useMemo(() => {\r\n    if (error) return error;\r\n\r\n    const { min, max } = attribute;\r\n    const hasNoOptions = required && (!possibleOptions.length);\r\n    const belowMin = sanitizedValue.length < min && (required || sanitizedValue.length > 0);\r\n    const aboveMax = sanitizedValue.length > max;\r\n\r\n    if (hasNoOptions) {\r\n      return 'No options, but field is required';\r\n    }\r\n\r\n    if (belowMin) {\r\n      return `Select at least ${min} options`;\r\n    }\r\n\r\n    if (aboveMax) {\r\n      return `Select at most ${max} options`;\r\n    }\r\n\r\n    return null;\r\n  }, [required, error, possibleOptions, sanitizedValue, attribute]);\r\n\r\n  return (\r\n    <Field.Root\r\n      hint={description?.id ? formatMessage(description) : hint}\r\n      error={fieldError as string}\r\n      name={name}\r\n      required={required}\r\n    >\r\n      <Flex direction=\"column\" alignItems=\"stretch\" gap={1}>\r\n        <Field.Label>{intlLabel?.id ? formatMessage(intlLabel) : label}</Field.Label>\r\n        {/* <ReactSelect\r\n          isSearchable={true}\r\n          isMulti={true}\r\n          error={fieldError}\r\n          name={name}\r\n          id={name}\r\n          isOptionDisabled={() => sanitizedValue.length >= attribute['max'] || false}\r\n          isDisabled={disabled || possibleOptions.length === 0}\r\n          placeholder={placeholder}\r\n          defaultValue={sanitizedValue.map((val: { label: string; value: string }) => ({\r\n            label: formatMessage({\r\n              id: val.label,\r\n              defaultMessage: val.label,\r\n            }),\r\n            value: val.value,\r\n          }))}\r\n          components={{\r\n            MultiValueContainer: ValueContainer,\r\n          }}\r\n          options={possibleOptions.map((option: { label: string; value: string }) => ({\r\n            ...option,\r\n            label: formatMessage({\r\n              id: option.label,\r\n              defaultMessage: option.label,\r\n            }),\r\n          }))}\r\n          onChange={(val: any) => {\r\n            onChange({\r\n              target: {\r\n                name: name,\r\n                value:\r\n                  val?.length && val.filter((v: any) => !!v)\r\n                    ? JSON.stringify(val.filter((v: any) => !!v).map((v: any) => v.value))\r\n                    : null,\r\n                type: attribute.type,\r\n              },\r\n            } as React.ChangeEvent<HTMLInputElement>);\r\n          }}\r\n          classNames={{\r\n            control: (_state: any) => 'select-control',\r\n            multiValue: (_state: any) => 'select-multi-value',\r\n            placeholder: (_state: any) => 'select-placeholder',\r\n            menuList: (_state: any) => 'select-listbox',\r\n            menu: (_state: any) => 'select-menu',\r\n            option: (state: any) => (state.isFocused ? 'option-focused' : 'option'),\r\n          }}\r\n        /> */}\r\n        <Field.Hint />\r\n        <Field.Error />\r\n      </Flex>\r\n    </Field.Root>\r\n  );\r\n};\r\n\r\nexport default Input;\r\n"],"names":["label","value"],"mappings":";;;;;AAQA,MAAM,QAAQ,CAAC;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,MAUM;AACJ,QAAM,EAAE,cAAA,IAAkB,QAAA;AAC1B,QAAM,EAAE,UAAU,OAAO,MAAA,IAAU,SAAS,IAAI;AAEhD,QAAM,kBAAkB,QAAQ,MAAM;AACpC,YAAQ,UAAU,SAAS,KAAK,CAAA,GAC7B,IAAI,CAAC,WAAmB;AACvB,YAAM,CAACA,QAAOC,MAAK,IAAI,CAAC,GAAG,OAAO,MAAM,QAAQ,GAAG,MAAM;AACzD,UAAI,CAACD,UAAS,CAACC,OAAO,QAAO;AAC7B,aAAO,EAAE,OAAAD,QAAO,OAAAC,OAAAA;AAAAA,IAClB,CAAC,EACA,OAAO,OAAO;AAAA,EACnB,GAAG,CAAC,SAAS,CAAC;AAEd,QAAM,iBAAiB,QAAQ,MAAM;AACnC,QAAI;AACJ,QAAI;AACF,oBAAc,OAAO,UAAU,WAAW,SAAS,CAAA,IAAK,KAAK,MAAM,SAAS,IAAI;AAAA,IAClF,SAAS,GAAG;AACV,oBAAc,CAAA;AAAA,IAChB;AACA,WAAO,MAAM,QAAQ,WAAW,IAC5B,YACC;AAAA,MAAI,CAAC,QACJ,gBAAgB,KAAK,CAAC,WAA6C,OAAO,UAAU,GAAG;AAAA,IAAA,EAExF,OAAO,CAAC,WAAW,CAAC,CAAC,MAAM,IAC5B,CAAA;AAAA,EACN,GAAG,CAAC,OAAO,eAAe,CAAC;AAE3B,QAAM,aAAa,QAAQ,MAAM;AAC/B,QAAI,MAAO,QAAO;AAElB,UAAM,EAAE,KAAK,IAAA,IAAQ;AACrB,UAAM,eAAe,YAAa,CAAC,gBAAgB;AACnD,UAAM,WAAW,eAAe,SAAS,QAAQ,YAAY,eAAe,SAAS;AACrF,UAAM,WAAW,eAAe,SAAS;AAEzC,QAAI,cAAc;AAChB,aAAO;AAAA,IACT;AAEA,QAAI,UAAU;AACZ,aAAO,mBAAmB,GAAG;AAAA,IAC/B;AAEA,QAAI,UAAU;AACZ,aAAO,kBAAkB,GAAG;AAAA,IAC9B;AAEA,WAAO;AAAA,EACT,GAAG,CAAC,UAAU,OAAO,iBAAiB,gBAAgB,SAAS,CAAC;AAEhE,SACE;AAAA,IAAC,MAAM;AAAA,IAAN;AAAA,MACC,MAAM,aAAa,KAAK,cAAc,WAAW,IAAI;AAAA,MACrD,OAAO;AAAA,MACP;AAAA,MACA;AAAA,MAEA,+BAAC,MAAA,EAAK,WAAU,UAAS,YAAW,WAAU,KAAK,GACjD,UAAA;AAAA,QAAA,oBAAC,MAAM,OAAN,EAAa,UAAA,WAAW,KAAK,cAAc,SAAS,IAAI,OAAM;AAAA,QAgD/D,oBAAC,MAAM,MAAN,EAAW;AAAA,QACZ,oBAAC,MAAM,OAAN,CAAA,CAAY;AAAA,MAAA,EAAA,CACf;AAAA,IAAA;AAAA,EAAA;AAGN;"}